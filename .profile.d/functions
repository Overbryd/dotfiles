# tmux, be there and be named well
function session-name-from-pwd {
  basename $PWD \
  | sed -e s/\[^a-zA-Z0-9\\\//\$]/-/g -e s/--*/-/g
}

# Start a new session
function tmn {
  local tmux="tmux -u"
  local session_name="$(session-name-from-pwd)$(tmux ls -F '#{session_name}' | grep --count $name)"

  $tmux new -s $session_name
}

# Start a new session or join the first one in this folder
function tms {
  local tmux="tmux -u"
  local session_name="$(session-name-from-pwd)0"

  $tmux new -A -s $session_name
}

# Open conflicts at once, setting the search pattern to <<<<<<< in order to cycle through them pressing 'n'
function editconflicts() { 
  vim +/"<<<<<<<" `git diff --name-only --diff-filter=U | xargs`
}

# quickly cleanup cruft from docker machine
function docker-cleanup() {
  docker rm `docker ps -a -q`
  docker rmi `docker images | grep "^<none" | tr -s ' ' | cut -d' ' -f 3`
  docker volume prune -f
}

# Identify the directory using a "file:" scheme URL,
# including the host name to disambiguate local vs.
# remote connections. Percent-escape spaces.
update_terminal_cwd() {
  local search=' '
  local replace='%20'
  local pwd_url="file://$HOSTNAME${PWD//$SEARCH/$replace}"
  printf '\e]7;%s\a' "$pwd_url"
}

# Escape terraform state identifierts
tf-escape() {
  sed -e 's/"/\\"/g'
}

# Randomize MAC address in order to use free wifi with less limits
randomize-mac() {
  openssl rand -hex 6 | sed  's/\(..\)/\1:/g; s/.$//' | sudo xargs ifconfig en0 ether
}

# Switch to a work or project directory
cdw() {
  local directory="$(fd --max-depth 2 --type d --base-directory ~/ --search-path Work --search-path Projects --glob '*' | fzf)"
  if [ $? -eq 0 ]; then
    cd ~/$directory
  fi
}

